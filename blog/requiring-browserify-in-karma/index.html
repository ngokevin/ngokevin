<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhml"
      xmlns:fb="http://ogp.me/ns/fb#"
      xml:lang="en" lang="en">

  <head>
    <title>ngokevin | Testing Project Browserify Modules in Karma Test Runner with Gulp</title>
    <link rel="stylesheet" type="text/css" href="/css/bundle.css" />
    <link href='http://fonts.googleapis.com/css?family=Ubuntu:400,500,700' rel='stylesheet' type='text/css'>
    <link rel="icon" type="image/x-icon" href="/img/favicon.ico?v=5"/>
    <meta name="viewport" content="width=device-width">
    
  <link rel="stylesheet" type="text/css" href="/css/page.css" />
  
  <meta property="og:description" content="If you want to test local Browserify modules in your project with Karma, you&#39;ll have to take an extra step. One solution is to use karma-browserify that bundles your modules with your tests, but it has downfalls requiring files that require other files. That really sucks since we&#39;ll often be unit testing local modules that depend on at least one other module, and thus it&#39;d only be useful for like requiring simple NPM modules. Another solution uses Gulp to manually build a test bundle and put it on the project JS root path such that local modules can be resolved. Here is the Gulp task in our gulpfile.js: var browserify = require(&#39;browserify&#39;); var glob = require(&#39;glob&#39;); // You&#39;ll have to install this too. gulp.task(&#39;tests&#39;, function() { // Bundle a test JS bundle and put it on our project JS root path. var testFiles = glob.sync(&#39;./tests/**/*.js&#39;); // Bundle all our tests. return browserify(testFiles).bundle({debug: true}) .pipe(source(&#39;tests.js&#39;)) // The bundle name. .pipe(gulp.dest(&#39;./www/js&#39;)); // The JS root path. }); A test bundle, containing all our test files, will be spit out on our JS root path. Now when we do require(&#39;myAppFolder/someJSFile&#39;), Browserify will easily be able to find the module. But we also have to tell Karma where our new test bundle is. Do so in our karma.config.js file: files: [ {pattern: &#39;www/js/tests.js&#39;, included: true} ] We&#39;ll also want to tell Gulp to re-bundle our tests every time the tests are touched. This can be annoying if you have Gulp set up to watch your JS path, since the tests will spit out a bundle on the JS path gulp.watch(&#39;./tests/**/*.js&#39;, [&#39;tests&#39;]); Run your tests and try requiring one of your project files. It should work!"/>

  </head>

  <body>
    <div id="wrap" class="c">
      <header>
        <div class="logos">
          <h1 id="logo">
            <a href='/'>ngo<strong>kevin</strong></a>
            <span class="social">
              <a href="mailto:me@ngokevin.com"><i class="fa fa-envelope"></i></a>
              <a href="http://twitter.com/andgokevin"><i class="fa fa-twitter-square"></i></a>
              <a href="http://github.com/ngokevin"><i class="fa fa-github-square"></i></a>
              <a type="application/rss+xml" href="/rss"><i class="fa fa-rss-square"></i></a>
            </span>
          </h1>
          <span id="sublogo">virtual reality developer at mozilla</span>
          <ul class="blog-tags">
            
              <li>
                <a href="/blog/tags/code/"
                   >
                  Code</a>
              </li>
            
              <li>
                <a href="/blog/tags/life/"
                   >
                  Life</a>
              </li>
            
              <li>
                <a href="/blog/tags/photography/"
                   >
                  Shoot</a>
              </li>
            
              <li>
                <a href="/blog/tags/poker/"
                   >
                  Poker</a>
              </li>
            
          </ul>
        </div>

        <nav>
          
            <a href="/about/">
              <span>
                About</span>
            </a>
          
            <a href="/">
              <span>
                Write</span>
            </a>
          
            <a href="/photography/">
              <span>
                Shoot</span>
            </a>
          
        </nav>
      </header>

      <div class="main">
        <div class="header-group">
  <div class="blog">
    <h1>Testing Project Browserify Modules in Karma Test Runner with Gulp</h1>

    <p class="metadata">
      
        Sunday August 31, 2014
      
    </p>
  </div>

  <div id="top-share" class="addthis_toolbox addthis_default_style">
  <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
  <a class="addthis_button_tweet"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-513af3cd5e69b4ae"></script>
</div>

        <div class="base-image">
          
        </div>

        
  <div class="page c">
    <p>If you want to test local Browserify modules in your project with
<a href="http://ngokevin.com/blog/angular-unit-testing/">Karma</a>, you'll have to take an
extra step. One solution is to use
<a href="https://github.com/xdissent/karma-browserify">karma-browserify</a> that bundles
your modules with your tests, but it has <a href="https://github.com/xdissent/karma-browserify/issues/38">downfalls requiring files that
require other files</a>.
That really sucks since we'll often be unit testing local modules that depend
on at least one other module, and thus it'd only be useful for like requiring
simple NPM modules.</p>
<p>Another solution uses <code>Gulp</code> to manually build a
test bundle and put it on the project JS root path such that local modules
can be resolved.</p>
<p>Here is the Gulp task in our <code>gulpfile.js</code>:</p>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">browserify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;browserify&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">glob</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;glob&#39;</span><span class="p">);</span>  <span class="c1">// You&#39;ll have to install this too.</span>

<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;tests&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Bundle a test JS bundle and put it on our project JS root path.</span>
    <span class="kd">var</span> <span class="nx">testFiles</span> <span class="o">=</span> <span class="nx">glob</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="s1">&#39;./tests/**/*.js&#39;</span><span class="p">);</span>  <span class="c1">// Bundle all our tests.</span>
    <span class="k">return</span> <span class="nx">browserify</span><span class="p">(</span><span class="nx">testFiles</span><span class="p">).</span><span class="nx">bundle</span><span class="p">({</span><span class="nx">debug</span><span class="o">:</span> <span class="kc">true</span><span class="p">})</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">source</span><span class="p">(</span><span class="s1">&#39;tests.js&#39;</span><span class="p">))</span>  <span class="c1">// The bundle name.</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">&#39;./www/js&#39;</span><span class="p">));</span>  <span class="c1">// The JS root path.</span>
<span class="p">});</span>
</pre></div>


<p>A test bundle, containing all our test files, will be spit out on our JS root
path. Now when we do <code>require('myAppFolder/someJSFile')</code>, Browserify will
easily be able to find the module.</p>
<p>But we also have to tell Karma where our new test bundle is. Do so in our
<code>karma.config.js</code> file:</p>
<div class="highlight"><pre><span class="nx">files</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="nx">pattern</span><span class="o">:</span> <span class="s1">&#39;www/js/tests.js&#39;</span><span class="p">,</span> <span class="nx">included</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
<span class="p">]</span>
</pre></div>


<p>We'll also want to tell Gulp to re-bundle our tests every time the tests are
touched. This can be annoying if you have Gulp set up to watch your JS path,
since the tests will spit out a bundle on the JS path</p>
<div class="highlight"><pre><span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="s1">&#39;./tests/**/*.js&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">]);</span>
</pre></div>


<p>Run your tests and try requiring one of your project files. It should work!</p>
  </div>

  <p class="end-sect">&sect;</p>
  <div id="bottom-share" class="addthis_toolbox addthis_default_style">
  <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
  <a class="addthis_button_tweet"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-513af3cd5e69b4ae"></script>
   <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'ngokevin'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
           var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
           dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
           (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
  <script src="https://cdn.jsdelivr.net/anchorjs/3.0.0/anchor.min.js"></script>
  <script>anchors.add('h2, h3, h4, h5, h6');</script>

      </div>
    </div>

    <div id="footer">
      <a href="mailto:me@ngokevin.com"><i class="fa fa-envelope"></i></a>
      <a href="http://twitter.com/ngokevin_"><i class="fa fa-twitter-square"></i></a>
      <a href="http://github.com/ngokevin"><i class="fa fa-github-square"></i></a>
      <a type="application/rss+xml" href="/rss/index.xml"><i class="fa fa-rss-square"></i></a>
    </div>

     <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-29871909-1']);
  _gaq.push(['_trackPageview']);

  (function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
  </body>
</html>