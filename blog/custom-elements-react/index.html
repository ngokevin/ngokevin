<html>
  <head>
    <title>Kevin Ngo</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="We have been building an increasing amount of Custom Elements, or Web Components, over at the Firefox Marketplace (using a polyfill). Custom Elements are a W3C specification that allow you to define...">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="ngokevin.com">
    <meta name="twitter:creator" content="Kevin Ngo">
    <meta name="twitter:title" content="Dropdown Component Using Custom Elements (vs. React)">
    <meta name="twitter:description" content="We have been building an increasing amount of Custom Elements, or Web Components, over at the Firefox Marketplace (using a polyfill). Custom Elements are a W3C specification that allow you to define...">
    <meta name="twitter:image" content="http://i.imgur.com/zPR4gcE.png">
    <link rel="stylesheet" href="/css/base.css">
    
     <link rel="stylesheet" href="/css/post.css"> 
    <script src="https://use.fontawesome.com/5b235cd0cb.js"></script>
  <link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>
  <body>
    <div class="post">
  
    <a href="/">&laquo; Kevin Ngo</a>
  

  <h1>Dropdown Component Using Custom Elements (vs. React)</h1>
  <p>14 May 2015</p>

  
    <img src="http://i.imgur.com/zPR4gcE.png">
  

  <p>We have been building an increasing amount of <a href="https://developer.mozilla.org/docs/Web/Web_Components/Custom_Elements" target="_blank" rel="external">Custom
Elements</a>,
or Web Components, over at the <a href="https://marketplace.firefox.com" target="_blank" rel="external">Firefox
Marketplace</a> (using a
<a href="https://github.com/WebReflection/document-register-element" target="_blank" rel="external">polyfill</a>). Custom
Elements are a W3C specification that allow you to define your own HTML
elements. Using Custom Elements, rather than arbitrary JS, encourages
modularity and testability, with portability and reusability being the enticer.</p>
<p>Over the last several months, I worked on revamping the UI for the Firefox
Marketplace. Part of it was building a custom dropdown element that would allow
users to filter apps based on platform compatibility. I wanted it to behave
exactly like a <code>&lt;select&gt;</code> element, complete with its interface, but with
the full license to style it however I needed.</p>
<p>In this post, I’ll go over Custom Elements, introduce an interesting “proxy”
pattern to extend native elements, and then compare Custom Elements with the
currently reigning Component king, <a href="http://facebook.github.io/react/" target="_blank" rel="external">React</a>.</p>
<hr>
<p><a href="https://github.com/mozilla/fireplace/blob/36ed622f6944a375d5d34e836025895fd149e91d/src/media/js/elements/select.js" target="_blank" rel="external">Custom Select source code</a>.</p>
<h2 id="building-a-custom-element"><a href="#building-a-custom-element" class="headerlink" title="Building a Custom Element"></a>Building a Custom Element</h2><p><a href="http://www.html5rocks.com/en/tutorials/webcomponents/customelements/" target="_blank" rel="external">Custom
Elements</a>
are still in working draft, but there is a nice <a href="https://github.com/WebReflection/document-register-element" target="_blank" rel="external">document.registerElement
polyfill</a>. Here
is an extremely simple Custom Element that simple wraps a <code>div</code> and
defines some interface on the element’s prototype.</p>
<pre class=" language-js"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">registerElement</span><span class="token punctuation">(</span><span class="token string">'input-wrapper'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    prototype<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>HTMLElement<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        createdCallback<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            value<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// Called after the component is "mounted" onto the DOM.</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        input<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        value<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span>value <span class="token operator">=</span> val<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> inputWrapper <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'input-wrapper'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>inputWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>We define the interface using Javascript’s <code>Object.create</code>, extending the
basic <code>HTMLElement</code>. The element simply wraps an input, and provides a
getter and setter on the input’s value. We drop it into the DOM, and it will
natively have whatever interface we defined for it. So we could do something
like <code>inputWrapper.value = 5</code> to directly set the inner <code>input</code>‘s
value. Basic example, but being able to create these native Custom Elements can
go far in modular development.</p>
<h2 id="proxy-pattern-extending-the-select-element-by-rerouting-interface"><a href="#proxy-pattern-extending-the-select-element-by-rerouting-interface" class="headerlink" title="Proxy Pattern: Extending the Select Element by Rerouting Interface"></a>Proxy Pattern: Extending the Select Element by Rerouting Interface</h2><p>Now we got a gist of what a Custom Element is, let’s see how we can use it to
create a custom dropdown by extending the native <code>&lt;select&gt;</code> element.</p>
<p>Here’s an example of how our element will be used in the HTML:</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>custom-select</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>my-select<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>custom-selected</span><span class="token punctuation">></span></span>
    The current selected option is <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>custom-selected-text</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>custom-selected-text</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>custom-selected</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optgroup</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>First value<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Second value<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Third value<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Fourth value<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optgroup</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mkt-select</span><span class="token punctuation">></span></span>
</code></pre>
<p>What we’ll do in the <code>createdCallback</code> is, if you check the source code,
create an actual internal hidden select element, copying the attributes
defined on <code>&lt;custom-select&gt;</code>. Then we’ll create <code>&lt;custom-options&gt;</code>,
copying the original options into the hidden select. We extend the custom
select’s interface to have an attribute pointing to the hidden select like so:</p>
<pre class=" language-js"><code class="language-js">select<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Actual &lt;select> element to proxy to, steal its interface.</span>
    <span class="token comment" spellcheck="true">// Value set in the createdCallback.</span>
    <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_select<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>select<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">copyAttrs</span><span class="token punctuation">(</span>select<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_select <span class="token operator">=</span> select<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
<p>This will allow our custom element to <em>absorb</em> the functionality of the
native select element. All we have to do is implement the entire interface of
the select element by routing to the internal select element.</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">proxyInterface</span><span class="token punctuation">(</span>destObj<span class="token punctuation">,</span> properties<span class="token punctuation">,</span> methods<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Proxies destObj.&lt;properties> and destObj.&lt;methods>() to</span>
    <span class="token comment" spellcheck="true">// destObj.&lt;key>.</span>
    properties<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>destObj<span class="token punctuation">,</span> prop<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// Already defined.</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// Set a property.</span>
        Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>destObj<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    methods<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// Set a method.</span>
        Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>destObj<span class="token punctuation">,</span> method<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            value<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">proxyInterface</span><span class="token punctuation">(</span>CustomSelectElement<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">'autofocus'</span><span class="token punctuation">,</span> <span class="token string">'disabled'</span><span class="token punctuation">,</span> <span class="token string">'form'</span><span class="token punctuation">,</span> <span class="token string">'labels'</span><span class="token punctuation">,</span> <span class="token string">'length'</span><span class="token punctuation">,</span> <span class="token string">'multiple'</span><span class="token punctuation">,</span>
     <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'onchange'</span><span class="token punctuation">,</span> <span class="token string">'options'</span><span class="token punctuation">,</span> <span class="token string">'required'</span><span class="token punctuation">,</span> <span class="token string">'selectedIndex'</span><span class="token punctuation">,</span> <span class="token string">'size'</span><span class="token punctuation">,</span>
     <span class="token string">'type'</span><span class="token punctuation">,</span> <span class="token string">'validationMessage'</span><span class="token punctuation">,</span> <span class="token string">'validity'</span><span class="token punctuation">,</span> <span class="token string">'willValidate'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token punctuation">[</span><span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token string">'blur'</span><span class="token punctuation">,</span> <span class="token string">'checkValidity'</span><span class="token punctuation">,</span> <span class="token string">'focus'</span><span class="token punctuation">,</span> <span class="token string">'item'</span><span class="token punctuation">,</span> <span class="token string">'namedItem'</span><span class="token punctuation">,</span>
     <span class="token string">'remove'</span><span class="token punctuation">,</span> <span class="token string">'setCustomValidity'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token string">'select'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>proxyInterface</code> will “route” the property lookups (the first array), and
method calls (the second array) from the custom select element to the internal
select element. Then all we need to do is make sure our select element’s value
is up-to-date while we interact with our custom select element, then we can do
things like <code>customSelectElement.selectedIndex</code> or
<code>customSelectElement.checkValidity()</code> without manually implementing the
interface.</p>
<p>Note we could have simply looped over <code>HTMLSelectElement.prototype</code> rather
than manually entering in each property and method name, but unfortunately that
doesn’t play well with some older browsers.</p>
<p>With all of this, we have a custom select element that is fully stylizable
while having all the functionality of a native select element (because it
extends it!).</p>
<h2 id="comparing-custom-elements-to-react"><a href="#comparing-custom-elements-to-react" class="headerlink" title="Comparing Custom Elements to React"></a>Comparing Custom Elements to React</h2><p>I love React and am using it for a couple of projects. How does Custom Elements
compare to it?</p>
<ol>
<li><p>Custom Elements has no answer to React’s JSX template/syntax. In most of
our Custom Elements, we have to manually shuffle things around using the native
DOM API. JSX is much, much easier.</p>
</li>
<li><p>Custom Elements has no data-binding or automatic DOM updates whenever data
updates. It’s all imperative with Custom Elements, you have to listen for changes
and manually update the DOM. React is, well, reactive. Whenever a component’s
state, so does its representation in the DOM.</p>
</li>
<li><p>Custom Elements is a bit harder to nest components than React. In React,
it’s natural for a component to render a component that renders a component
that renders other components. With Custom Elements, it’s a bit difficult to
connect components together in a nice heirarchy, and the only communication
you get is through Events.</p>
</li>
<li><p>Custom Elements, however, is smaller in KB. React is about 26KB after
min+gzip whereas a Custom Elements polyfill is maybe a few KB. Though the 26KB
might be worth it since you’ll end up writing less code, and you get the
performance of virtual DOM diffing.</p>
</li>
<li><p>Custom Elements has no answer to React Native.</p>
</li>
</ol>
<p>They’re both just as portable, they both can be dropped into any framework.
They both have similar interfaces as well in creating components. Although,
React is more powerful. In React, I really enjoy keeping data compartmentalized
in states and passing down data as props. Loose comparison, but it’s like
combining the data-binding and template power of Angular with the ideas of
Custom Elements.</p>
<p>However, it doesn’t have to be one or the other either. Why not both? React can
wrap Custom Elements if you want it to. As always, choose the best tools for
the job.</p>

</div>


    <div class="social">
      <a href="https://github.com/ngokevin/"><i class="fa fa-github-alt" aria-hidden="true"></i></a>
      <a href="https://twitter.com/andgokevin/"><i class="fa fa-twitter" aria-hidden="true"></i></a>
      <a href="https://instagram.com/andgokevin/"><i class="fa fa-instagram" aria-hidden="true"></i></a>
    </div>

    <script src="https://cdn.jsdelivr.net/blazy/1.8.2/blazy.min.js"></script>
    <script>new Blazy({selector: '.lazyload'});</script>
  </body>
</html>
