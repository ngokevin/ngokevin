<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhml"
      xmlns:fb="http://ogp.me/ns/fb#"
      xml:lang="en" lang="en">

  <head>
    <title>ngokevin | Swan Dive! Into d3.js</title>
    <link rel="stylesheet" type="text/css" href="/css/bundle.css" />
    <link href='http://fonts.googleapis.com/css?family=Ubuntu:400,500,700' rel='stylesheet' type='text/css'>
    <link rel="icon" type="image/x-icon" href="/img/favicon.ico?v=5"/>
    <meta name="viewport" content="width=device-width">
    
  <link rel="stylesheet" type="text/css" href="/css/page.css" />
  
  <meta property="og:description" content="Today, I started experimenting with d3.js. A fortune-teller hinted to me that I would be doing a lot of data visualization work in the near-future and that d3.js would come in handy. Since my grades for last term just came out today, I figured graphing my GPA over the last three years would be a nice toy start. It would also be a nice visualization for me to reflect on the last three years since I&#39;m done with school for the next six months. What is d3.js? d3.js is a small Javascript library for &#39;manipulating documents based on data&#39;. d3 stands for data-driven documents. More specifically, d3.js is used to bind data and apply data-driven transformations to DOM elements. However, it is not a visualization framework loaded with visualization functions. It is more of a tool that focuses on efficient manipulation of documents based on data. Because it&#39;s simply a tool, it can be used to build whatever kind of data visualizations or graphs needed. Let&#39;s draw a useless circle d3 makes it easy to add SVG elements and manipulate them with its jQuery-esque method chaining. We&#39;ll go through the usual most basic stuff. Let&#39;s draw a pretty blue and orange circle. // create an SVG canvas, specifying its position and size var demo = d3.select(&#39;#demo&#39;). append(&#39;svg:svg&#39;). attr(&#39;x&#39;, 500). attr(&#39;y&#39;, 500). attr(&#39;width&#39;, 120). attr(&#39;height&#39;, 120); // draw a circle on the canvas specifying its color, radius, position demo.append(&#39;svg:circle&#39;). style(&#39;stroke&#39;, &#39;blue&#39;). style(&#39;fill&#39;, &#39;orange&#39;). attr(&#39;r&#39;, 40). attr(&#39;cx&#39;, 50). attr(&#39;cy&#39;, 50); And boom, a useless circle. var demo = d3.select(&#39;#demo&#39;). append(&#39;svg:svg&#39;). attr(&#39;x&#39;, 500). attr(&#39;y&#39;, 500). attr(&#39;width&#39;, 120). attr(&#39;height&#39;, 120); // draw a circle on the canvas specifying its color, radius, position demo.append(&#39;svg:circle&#39;). style(&#39;stroke&#39;, &#39;blue&#39;). style(&#39;fill&#39;, &#39;orange&#39;). attr(&#39;r&#39;, 40). attr(&#39;cx&#39;, 50). attr(&#39;cy&#39;, 50); We can make it do some useless stuff like event-driven (hover) CSS3 transitions. We&#39;ll have it expand and shrink on mouseover and mouseout respectively. demo.append(&#39;svg:circle&#39;). style(&#39;stroke&#39;, &#39;blue&#39;). style(&#39;fill&#39;, &#39;orange&#39;). attr(&#39;r&#39;, 40). attr(&#39;cx&#39;, 50). attr(&#39;cy&#39;, 50). on(&#39;mouseover&#39;, function(){ d3.select(this). transition(). delay(100). duration(1000). attr(&#39;r&#39;, 10) }). on(&#39;mouseout&#39;, function() { d3.select(this). transition(). delay(100). duration(1000). attr(&#39;r&#39;, 100) }); Try hovering over this baby. var demo = d3.select(&#39;#demo2&#39;). append(&#39;svg:svg&#39;). attr(&#39;x&#39;, 500). attr(&#39;y&#39;, 500). attr(&#39;width&#39;, 120). attr(&#39;height&#39;, 100); demo.append(&#39;svg:circle&#39;). style(&#39;stroke&#39;, &#39;blue&#39;). style(&#39;fill&#39;, &#39;orange&#39;). attr(&#39;r&#39;, 40). attr(&#39;cx&#39;, 50). attr(&#39;cy&#39;, 50). on(&#39;mouseover&#39;, function(){ d3.select(this). transition(). delay(100). duration(1000). attr(&#39;r&#39;, 10) }). on(&#39;mouseout&#39;, function() { d3.select(this). transition(). delay(100). duration(1000). attr(&#39;r&#39;, 40) }); Working with data, a simple GPA bar chart d3.js without actual data is pretty pointless. The documentation explains everything in better detail, but for a &#39;case study&#39; let&#39;s build a simple GPA bar chart. First, we need to define our data. var gpa_term_data = [ {&#39;term&#39;: &#39;F09&#39;, &#39;gpa&#39;: 3.40}, {&#39;term&#39;: &#39;W10&#39;, &#39;gpa&#39;: 3.32}, {&#39;term&#39;: &#39;S10&#39;, &#39;gpa&#39;: 3.56}, {&#39;term&#39;: &#39;F10&#39;, &#39;gpa&#39;: 3.32}, {&#39;term&#39;: &#39;W11&#39;, &#39;gpa&#39;: 3.57}, {&#39;term&#39;: &#39;S11&#39;, &#39;gpa&#39;: 3.71}, {&#39;term&#39;: &#39;F11&#39;, &#39;gpa&#39;: 3.72}, {&#39;term&#39;: &#39;W12&#39;, &#39;gpa&#39;: 3.92}, ]; In this case, we want GPA by term. So we create a list of objects holding the data. Next, we&#39;ll set up the chart itself, its size, position, and scales. var barWidth = 70; var chartWidth = (barWidth + 10) * gpa_term_data.length; var chartHeight = 200; var padding = 20; // scales var xScale = d3.scale.linear(). domain([0, gpa_term_data.length]). range([0, chartWidth]); var yScale = d3.scale.linear(). domain([3, d3.max(gpa_term_data, function(datum) { return datum.gpa; })]). range([0, chartHeight]); d3 has scale functions that return functions. In our definition, the domain is about the data, and the range is more about the number of pixels the data is mapped to. For X, the domain is are the terms and for Y, the domain is the GPA. We&#39;ll only care about GPA over 3.0 so we set the minimum as such. We have the domain map to the range linearly, and we can use the returned function to help position data around the chart. Next we&#39;ll create the actual bars. // create rectangle for each datum chart.selectAll(&#39;rect&#39;). data(gpa_term_data). enter(). append(&#39;svg:rect&#39;). attr(&#39;x&#39;, function(datum, index) { // return x-offset pixels return xScale(index); }). attr(&#39;y&#39;, function(datum) { // return y-offset pixels, subtract due to origin being in top left return chartHeight - yScale(datum.gpa); }). attr(&#39;height&#39;, function(datum) { return yScale(datum.gpa); }). attr(&#39;width&#39;, barWidth). attr(&#39;fill&#39;, &#39;#2d578b&#39;); Here, we use a common pattern, selectAll.data.enter.append. selectAll selects all elements that match (like jQuery), here we select SVG rectangles, but we haven&#39;t created any rectangles yet. Well if we use data() and pass in our data, we can create them on-the-fly. When we pass in data that don&#39;t have any elements to bind to, the data is considered leftover and is stored in the enter selection. So the data isn&#39;t binded yet, but if we call enter(), enter will take all the leftover data and automatically create elements out of them. We are thus effectively binding our data to rectangle elements, the heart of d3.js!. There is a function called exit() that does the opposite, remove elements that don&#39;t have any data binded, but it isn&#39;t used here. Finally, actually create and append the elements onto the chart. While we&#39;re creating the rectangles, we specify their size and position. We make use of Javascript anonymous functions which d3 expects to take a datum and an optional index argument. The datum is the data binded to the element and the index is the, well, index among the data set. For the x-position, we call our scale function we created earlier to get the pixel offset. We do similar for y, but since the coordinate system features the origin on the top-left, we subtract it from the chartHeight. The height of the bar is set to be the GPA, and that&#39;s the meat of it. We do similar things to position the axes and text (check the source of this page to see) except we have to pad the chart to make room for the axes. We eventually have the finished bar chart. // define data var gpa_term_data = [ {&#39;term&#39;: &#39;F09&#39;, &#39;gpa&#39;: 3.40}, {&#39;term&#39;: &#39;W10&#39;, &#39;gpa&#39;: 3.32}, {&#39;term&#39;: &#39;S10&#39;, &#39;gpa&#39;: 3.56}, {&#39;term&#39;: &#39;F10&#39;, &#39;gpa&#39;: 3.32}, {&#39;term&#39;: &#39;W11&#39;, &#39;gpa&#39;: 3.57}, {&#39;term&#39;: &#39;S11&#39;, &#39;gpa&#39;: 3.71}, {&#39;term&#39;: &#39;F11&#39;, &#39;gpa&#39;: 3.72}, {&#39;term&#39;: &#39;W12&#39;, &#39;gpa&#39;: 3.92}, ]; var barWidth = 70; var chartWidth = (barWidth + 10) * gpa_term_data.length; var chartHeight = 200; var padding = 20; // scales var xScale = d3.scale.linear(). domain([0, gpa_term_data.length]). range([0, chartWidth]); var yScale = d3.scale.linear(). domain([3, d3.max(gpa_term_data, function(datum) { return datum.gpa; })]). range([0, chartHeight]); // create canvas var chart = d3.select(&#39;#chart&#39;). append(&#39;svg:svg&#39;). attr(&#39;width&#39;, chartWidth). attr(&#39;height&#39;, chartHeight + padding); // create rectangle for each datum chart.selectAll(&#39;rect&#39;). data(gpa_term_data). enter(). append(&#39;svg:rect&#39;). attr(&#39;x&#39;, function(datum, index) { // return x-offset pixels return xScale(index); }). attr(&#39;y&#39;, function(datum) { // return y-offset pixels, subtract due to origin being in top left return chartHeight - yScale(datum.gpa); }). attr(&#39;height&#39;, function(datum) { return yScale(datum.gpa); }). attr(&#39;width&#39;, barWidth). attr(&#39;fill&#39;, &#39;#2d578b&#39;); // text chart.selectAll(&#39;text&#39;). data(gpa_term_data). enter(). append(&#39;svg:text&#39;). text(function(datum) { return datum.gpa; }). attr(&#39;x&#39;, function(datum, index) { return xScale(index) + barWidth / 2; }). attr(&#39;y&#39;, function(datum) { return chartHeight - yScale(datum.gpa); }). attr(&#39;dy&#39;, &#39;1.2em&#39;). // y padding attr(&#39;text-anchor&#39;, &#39;middle&#39;). attr(&#39;fill&#39;, &#39;white&#39;). attr(&#34;style&#34;, &#34;font-size: 12; font-family: Helvetica, sans-serif&#34;); // X axis text chart.selectAll(&#39;text.xAxis&#39;). data(gpa_term_data). enter(). append(&#39;svg:text&#39;). attr(&#39;class&#39;, &#39;xAxis&#39;). text(function(datum) { return datum.term; }). attr(&#39;x&#39;, function(datum, index) { return xScale(index) + barWidth / 2; }). attr(&#39;y&#39;, chartHeight + padding). attr(&#39;text-anchor&#39;, &#39;middle&#39;). attr(&#34;style&#34;, &#34;font-size: 12; font-family: Helvetica, sans-serif&#34;); // chart label chart.append(&#39;svg:text&#39;). attr(&#39;class&#39;, &#39;label&#39;). text(&#39;GPA by Term&#39;). attr(&#39;x&#39;, 0). attr(&#39;y&#39;, 15); Over the next few days, I&#39;ll be doing more things with d3.js. In the future, I hope to do data visualization work with Cyder and at Mozilla. It&#39;s just so pretty and fun!"/>

  </head>

  <body>
    <div id="wrap" class="c">
      <header>
        <div class="logos">
          <h1 id="logo">
            <a href='/'>ngo<strong>kevin</strong></a>
            <span class="social">
              <a href="mailto:me@ngokevin.com"><i class="fa fa-envelope"></i></a>
              <a href="http://twitter.com/andgokevin"><i class="fa fa-twitter-square"></i></a>
              <a href="http://github.com/ngokevin"><i class="fa fa-github-square"></i></a>
              <a type="application/rss+xml" href="/rss"><i class="fa fa-rss-square"></i></a>
            </span>
          </h1>
          <span id="sublogo">virtual reality developer at mozilla</span>
          <ul class="blog-tags">
            
              <li>
                <a href="/blog/tags/code/"
                   >
                  Code</a>
              </li>
            
              <li>
                <a href="/blog/tags/life/"
                   >
                  Life</a>
              </li>
            
              <li>
                <a href="/blog/tags/photography/"
                   >
                  Shoot</a>
              </li>
            
              <li>
                <a href="/blog/tags/poker/"
                   >
                  Poker</a>
              </li>
            
          </ul>
        </div>

        <nav>
          
            <a href="/about/">
              <span>
                About</span>
            </a>
          
            <a href="/">
              <span>
                Write</span>
            </a>
          
            <a href="/photography/">
              <span>
                Shoot</span>
            </a>
          
        </nav>
      </header>

      <div class="main">
        <div class="header-group">
  <div class="blog">
    <h1>Swan Dive! Into d3.js</h1>

    <p class="metadata">
      
        Monday March 26, 2012
      
    </p>
  </div>

  <div id="top-share" class="addthis_toolbox addthis_default_style">
  <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
  <a class="addthis_button_tweet"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-513af3cd5e69b4ae"></script>
</div>

        <div class="base-image">
          
        </div>

        
  <div class="page c">
    <p>Today, I started experimenting with d3.js. A fortune-teller hinted to me that
I would be doing a lot of data visualization work in the near-future and that
d3.js would come in handy. Since my grades for last term just came out today,
I figured graphing my GPA over the last three years would be a nice toy
start. It would also be a nice visualization for me to reflect on the last
three years since I'm done with school for the next six months.</p>
<h2 id="what-is-d3js">What is d3.js?</h2>
<p>d3.js is a small Javascript library for 'manipulating documents based on
data'. d3 stands for <em>data-driven documents</em>. More specifically, d3.js is
used to bind data and apply <em>data-driven transformations</em> to DOM elements.
However, it is not a visualization framework loaded with visualization
functions. It is more of a tool that focuses on efficient manipulation of
documents based on data. Because it's simply a tool, it can be used to build
whatever kind of data visualizations or graphs needed.</p>
<script type="text/javascript" src="http://mbostock.github.com/d3/d3.js"></script>

<h2 id="lets-draw-a-useless-circle">Let's draw a useless circle</h2>
<p>d3 makes it easy to add SVG elements and manipulate them with its
jQuery-esque method chaining. We'll go through the usual most basic stuff.
Let's draw a pretty blue and orange circle.</p>
<div class="highlight"><pre><span class="c1">// create an SVG canvas, specifying its position and size</span>
<span class="kd">var</span> <span class="nx">demo</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;#demo&#39;</span><span class="p">).</span>
    <span class="nx">append</span><span class="p">(</span><span class="s1">&#39;svg:svg&#39;</span><span class="p">).</span>
    <span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">).</span>
    <span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">).</span>
    <span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="mi">120</span><span class="p">).</span>
    <span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="mi">120</span><span class="p">);</span>

<span class="c1">// draw a circle on the canvas specifying its color, radius, position</span>
<span class="nx">demo</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;svg:circle&#39;</span><span class="p">).</span>
    <span class="nx">style</span><span class="p">(</span><span class="s1">&#39;stroke&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">).</span>
    <span class="nx">style</span><span class="p">(</span><span class="s1">&#39;fill&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">).</span>
    <span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">40</span><span class="p">).</span>
    <span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;cx&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">).</span>
    <span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;cy&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
</pre></div>


<p>And boom, a useless circle.</p>
<div id="demo"></div>

<script type="text/javascript" />
    var demo = d3.select('#demo').
        append('svg:svg').
        attr('x', 500).
        attr('y', 500).
        attr('width', 120).
        attr('height', 120);

    // draw a circle on the canvas specifying its color, radius, position
    demo.append('svg:circle').
        style('stroke', 'blue').
        style('fill', 'orange').
        attr('r', 40).
        attr('cx', 50).
        attr('cy', 50);
</script>

<p>We can make it do some useless stuff like event-driven (hover) CSS3
transitions. We'll have it expand and shrink on mouseover and mouseout
respectively.</p>
<div class="highlight"><pre><span class="nx">demo</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;svg:circle&#39;</span><span class="p">).</span>
    <span class="nx">style</span><span class="p">(</span><span class="s1">&#39;stroke&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">).</span>
    <span class="nx">style</span><span class="p">(</span><span class="s1">&#39;fill&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">).</span>
    <span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">40</span><span class="p">).</span>
    <span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;cx&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">).</span>
    <span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;cy&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">).</span>
    <span class="nx">on</span><span class="p">(</span><span class="s1">&#39;mouseover&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">).</span>
        <span class="nx">transition</span><span class="p">().</span>
            <span class="nx">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">).</span>
            <span class="nx">duration</span><span class="p">(</span><span class="mi">1000</span><span class="p">).</span>
            <span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="p">}).</span>
    <span class="nx">on</span><span class="p">(</span><span class="s1">&#39;mouseout&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">).</span>
            <span class="nx">transition</span><span class="p">().</span>
                <span class="nx">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">).</span>
                <span class="nx">duration</span><span class="p">(</span><span class="mi">1000</span><span class="p">).</span>
                <span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="p">});</span>
</pre></div>


<p>Try hovering over this baby.</p>
<div id="demo2"></div>

<script type="text/javascript" />
    var demo = d3.select('#demo2').
        append('svg:svg').
        attr('x', 500).
        attr('y', 500).
        attr('width', 120).
        attr('height', 100);

    demo.append('svg:circle').
        style('stroke', 'blue').
        style('fill', 'orange').
        attr('r', 40).
        attr('cx', 50).
        attr('cy', 50).
        on('mouseover', function(){
            d3.select(this).
            transition().
                delay(100).
                duration(1000).
                attr('r', 10)
        }).
        on('mouseout', function() {
            d3.select(this).
                transition().
                    delay(100).
                    duration(1000).
                    attr('r', 40)
        });
</script>

<h2 id="working-with-data-a-simple-gpa-bar-chart">Working with data, a simple GPA bar chart</h2>
<p>d3.js without actual data is pretty pointless. The documentation explains
everything in better detail, but for a 'case study' let's build a simple GPA
bar chart. First, we need to define our data.</p>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">gpa_term_data</span> <span class="o">=</span> <span class="p">[</span>
<span class="p">{</span><span class="s1">&#39;term&#39;</span><span class="o">:</span> <span class="s1">&#39;F09&#39;</span><span class="p">,</span> <span class="s1">&#39;gpa&#39;</span><span class="o">:</span> <span class="mf">3.40</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;term&#39;</span><span class="o">:</span> <span class="s1">&#39;W10&#39;</span><span class="p">,</span> <span class="s1">&#39;gpa&#39;</span><span class="o">:</span> <span class="mf">3.32</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;term&#39;</span><span class="o">:</span> <span class="s1">&#39;S10&#39;</span><span class="p">,</span> <span class="s1">&#39;gpa&#39;</span><span class="o">:</span> <span class="mf">3.56</span><span class="p">},</span>

<span class="p">{</span><span class="s1">&#39;term&#39;</span><span class="o">:</span> <span class="s1">&#39;F10&#39;</span><span class="p">,</span> <span class="s1">&#39;gpa&#39;</span><span class="o">:</span> <span class="mf">3.32</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;term&#39;</span><span class="o">:</span> <span class="s1">&#39;W11&#39;</span><span class="p">,</span> <span class="s1">&#39;gpa&#39;</span><span class="o">:</span> <span class="mf">3.57</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;term&#39;</span><span class="o">:</span> <span class="s1">&#39;S11&#39;</span><span class="p">,</span> <span class="s1">&#39;gpa&#39;</span><span class="o">:</span> <span class="mf">3.71</span><span class="p">},</span>

<span class="p">{</span><span class="s1">&#39;term&#39;</span><span class="o">:</span> <span class="s1">&#39;F11&#39;</span><span class="p">,</span> <span class="s1">&#39;gpa&#39;</span><span class="o">:</span> <span class="mf">3.72</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;term&#39;</span><span class="o">:</span> <span class="s1">&#39;W12&#39;</span><span class="p">,</span> <span class="s1">&#39;gpa&#39;</span><span class="o">:</span> <span class="mf">3.92</span><span class="p">},</span>
<span class="p">];</span>
</pre></div>


<p>In this case, we want GPA by term. So we create a list of objects holding the
data. Next, we'll set up the chart itself, its size, position, and scales.</p>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">barWidth</span> <span class="o">=</span> <span class="mi">70</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">chartWidth</span> <span class="o">=</span> <span class="p">(</span><span class="nx">barWidth</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="nx">gpa_term_data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">chartHeight</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">padding</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>

<span class="c1">// scales</span>
<span class="kd">var</span> <span class="nx">xScale</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scale</span><span class="p">.</span><span class="nx">linear</span><span class="p">().</span>
    <span class="nx">domain</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nx">gpa_term_data</span><span class="p">.</span><span class="nx">length</span><span class="p">]).</span>
    <span class="nx">range</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nx">chartWidth</span><span class="p">]);</span>

<span class="kd">var</span> <span class="nx">yScale</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scale</span><span class="p">.</span><span class="nx">linear</span><span class="p">().</span>
    <span class="nx">domain</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">gpa_term_data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">datum</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">datum</span><span class="p">.</span><span class="nx">gpa</span><span class="p">;</span>
    <span class="p">})]).</span>
    <span class="nx">range</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nx">chartHeight</span><span class="p">]);</span>
</pre></div>


<p>d3 has scale functions that return functions. In our definition, the domain
is about the data, and the range is more about the number of pixels the data
is mapped to. For X, the domain is are the terms and for Y, the domain is the
GPA. We'll only care about GPA over 3.0 so we set the minimum as such. We
have the domain map to the range linearly, and we can use the returned
function to help position data around the chart. Next we'll create the actual
bars.</p>
<div class="highlight"><pre><span class="c1">// create rectangle for each datum</span>
<span class="nx">chart</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;rect&#39;</span><span class="p">).</span>
    <span class="nx">data</span><span class="p">(</span><span class="nx">gpa_term_data</span><span class="p">).</span>
    <span class="nx">enter</span><span class="p">().</span>
    <span class="nx">append</span><span class="p">(</span><span class="s1">&#39;svg:rect&#39;</span><span class="p">).</span>
    <span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">datum</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// return x-offset pixels</span>
        <span class="k">return</span> <span class="nx">xScale</span><span class="p">(</span><span class="nx">index</span><span class="p">);</span>
    <span class="p">}).</span>
    <span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">datum</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// return y-offset pixels, subtract due to origin being in top left</span>
        <span class="k">return</span> <span class="nx">chartHeight</span> <span class="o">-</span> <span class="nx">yScale</span><span class="p">(</span><span class="nx">datum</span><span class="p">.</span><span class="nx">gpa</span><span class="p">);</span>
    <span class="p">}).</span>
    <span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">datum</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">yScale</span><span class="p">(</span><span class="nx">datum</span><span class="p">.</span><span class="nx">gpa</span><span class="p">);</span>
    <span class="p">}).</span>
    <span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="nx">barWidth</span><span class="p">).</span>
    <span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;fill&#39;</span><span class="p">,</span> <span class="s1">&#39;#2d578b&#39;</span><span class="p">);</span>
</pre></div>


<p>Here, we use a common pattern, <em>selectAll.data.enter.append</em>. selectAll
selects all elements that match (like jQuery), here we select SVG rectangles,
but we haven't created any rectangles yet. Well if we use <em>data()</em> and pass in
our data, we can create them on-the-fly. When we pass in data that don't have
any elements to bind to, the data is considered leftover and is stored in the
<em>enter selection</em>. So the data isn't binded yet, but if we call <em>enter()</em>,
enter will take all the leftover data and automatically create elements out
of them. We are thus effectively binding our data to rectangle elements,
<strong>the heart of d3.js!</strong>. There is a function called <em>exit()</em> that does the
opposite, remove elements that don't have any data binded, but it isn't used
here. Finally, actually create and append the elements onto the chart.</p>
<p>While we're creating the rectangles, we specify their size and position. We
make use of Javascript anonymous functions which d3 expects to take a <em>datum</em>
and an optional <em>index</em> argument. The datum is the data binded to the element
and the index is the, well, index among the data set. For the x-position, we
call our scale function we created earlier to get the pixel offset. We do
similar for y, but since the coordinate system features the origin on the
top-left, we subtract it from the chartHeight. The height of the bar is set
to be the GPA, and that's the meat of it.</p>
<p>We do similar things to position the axes and text (check the source of this
page to see) except we have to pad the chart to make room for the axes. We
eventually have the finished bar chart.
<br/>
<br/></p>
<div id="chart"></div>

<script type="text/javascript">
// define data
var gpa_term_data = [
    {'term': 'F09', 'gpa': 3.40},
    {'term': 'W10', 'gpa': 3.32},
    {'term': 'S10', 'gpa': 3.56},

    {'term': 'F10', 'gpa': 3.32},
    {'term': 'W11', 'gpa': 3.57},
    {'term': 'S11', 'gpa': 3.71},

    {'term': 'F11', 'gpa': 3.72},
    {'term': 'W12', 'gpa': 3.92},
];

var barWidth = 70;
var chartWidth = (barWidth + 10) * gpa_term_data.length;
var chartHeight = 200;
var padding = 20;

// scales
var xScale = d3.scale.linear().
    domain([0, gpa_term_data.length]).
    range([0, chartWidth]);

var yScale = d3.scale.linear().
    domain([3, d3.max(gpa_term_data, function(datum) {
        return datum.gpa;
    })]).
    range([0, chartHeight]);

// create canvas
var chart = d3.select('#chart').
    append('svg:svg').
    attr('width', chartWidth).
    attr('height', chartHeight + padding);

// create rectangle for each datum
chart.selectAll('rect').
    data(gpa_term_data).
    enter().
    append('svg:rect').
    attr('x', function(datum, index) {
        // return x-offset pixels
        return xScale(index);
    }).
    attr('y', function(datum) {
        // return y-offset pixels, subtract due to origin being in top left
        return chartHeight - yScale(datum.gpa);
    }).
    attr('height', function(datum) {
        return yScale(datum.gpa);
    }).
    attr('width', barWidth).
    attr('fill', '#2d578b');

// text
chart.selectAll('text').
    data(gpa_term_data).
    enter().
    append('svg:text').
    text(function(datum) {
        return datum.gpa;
    }).
    attr('x', function(datum, index) {
        return xScale(index) + barWidth / 2;
    }).
    attr('y', function(datum) {
        return chartHeight - yScale(datum.gpa);
    }).
    attr('dy', '1.2em'). // y padding
    attr('text-anchor', 'middle').
    attr('fill', 'white').
    attr("style", "font-size: 12; font-family: Helvetica, sans-serif");

// X axis text
chart.selectAll('text.xAxis').
    data(gpa_term_data).
    enter().
    append('svg:text').
    attr('class', 'xAxis').
    text(function(datum) {
        return datum.term;
    }).
    attr('x', function(datum, index) {
        return xScale(index) + barWidth / 2;
    }).
    attr('y', chartHeight + padding).
    attr('text-anchor', 'middle').
    attr("style", "font-size: 12; font-family: Helvetica, sans-serif");

// chart label
chart.append('svg:text').
    attr('class', 'label').
    text('GPA by Term').
    attr('x', 0).
    attr('y', 15);
</script>

<p><br/>
Over the next few days, I'll be doing more things with d3.js. In the future,
I hope to do data visualization work with
<a href="http://github.com/uberj/cyder">Cyder</a> and at Mozilla. It's just so pretty
and fun!</p>
  </div>

  <p class="end-sect">&sect;</p>
  <div id="bottom-share" class="addthis_toolbox addthis_default_style">
  <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
  <a class="addthis_button_tweet"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-513af3cd5e69b4ae"></script>
   <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'ngokevin'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
           var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
           dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
           (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
  <script src="https://cdn.jsdelivr.net/anchorjs/3.0.0/anchor.min.js"></script>
  <script>anchors.add('h2, h3, h4, h5, h6');</script>

      </div>
    </div>

    <div id="footer">
      <a href="mailto:me@ngokevin.com"><i class="fa fa-envelope"></i></a>
      <a href="http://twitter.com/ngokevin_"><i class="fa fa-twitter-square"></i></a>
      <a href="http://github.com/ngokevin"><i class="fa fa-github-square"></i></a>
      <a type="application/rss+xml" href="/rss/index.xml"><i class="fa fa-rss-square"></i></a>
    </div>

     <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-29871909-1']);
  _gaq.push(['_trackPageview']);

  (function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
  </body>
</html>