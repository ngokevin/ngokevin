<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhml"
      xmlns:fb="http://ogp.me/ns/fb#"
      xml:lang="en" lang="en">

  <head>
    <title>ngokevin | Using react-router with redux</title>
    <link rel="stylesheet" type="text/css" href="/css/bundle.css" />
    <link href='http://fonts.googleapis.com/css?family=Ubuntu:400,500,700' rel='stylesheet' type='text/css'>
    <link rel="icon" type="image/x-icon" href="/img/favicon.ico?v=5"/>
    <meta name="viewport" content="width=device-width">
    
  <link rel="stylesheet" type="text/css" href="/css/page.css" />
  
    <meta property="og:image" content="http://i.imgur.com/6Jqxo6Kl.jpg"/>
  
  <meta property="og:description" content="I&#39;m working on submission and reviewer tools for FirefoxOS add-ons, which I&#39;d like to shout out is the most exciting thing to hit FirefoxOS yet. It&#39;ll enable a customization community as powerful as CyanogenMod yet be much more accessible. For this project, I wanted to port our Flux framework from Flummox to Redux while using react-router. I always struggle with getting react-router to pass Redux-related context to the handler components. Having done this twice and running into many pitfalls, I am sharing my experiences to prospective struggle-bus riders. Note this guide will feature: ES6 code react@0.13 react-redux@0.9.0 react-router@1.0.0-beta1 redux@1.0.0 If you are behind on these versions, I recommend upgrading. The Flux community is moving very rapidly, so keep up. app.js Have your Redux store created. This is explained in the Redux documentation so I won&#39;t go into detail here. But I will note that we are using acdlite&#39;s redux-react-router library which conveniently makes availalbe react-router state inside of our Redux store, and features action creators for react-router. import React from &#39;react&#39;; import {Provider} from &#39;react-redux&#39;; import {Route, Router} from &#39;react-router&#39;; import {history} from &#39;react-router/lib/BrowserHistory&#39;; import {combineReducers, createStore} from &#39;redux&#39;; import {reduxRouteComponent, routerStateReducer as router} from &#39;redux-react-router&#39;; import App from &#39;./components/App&#39;; const reducer = combineReducers({ router: routerStateReducer, // ...other reducers. }); const store = createStore(reducer); Next, imagine that App is our root-level handler component. We&#39;re going to need to wrap it with a Redux Provider such that it has access to the Redux store. Why do we need to do this? We are using redux-react-router which should magically handle passing the Redux store as context into the handler component for us, but unfortunately react@0.13 does owner-based context which kills this feature. react@0.14 will do parent-based context so this will work in the future without need for wrapping. Owner-based context is also why we wrap our component in a function inside the Provider. class ReduxApp extends React.Component { render() { return &lt;Provider store={store}&gt; {() =&gt; &lt;App {...this.props}/&gt;} &lt;/Provider&gt; } } Now let&#39;s build our Router and start the render: React.render(&lt;Router history={history}&gt; &lt;Route component={reduxRouteComponent(store)}&gt; &lt;Route name=&#34;app&#34; path=&#34;/&#34; component={ReduxApp}&gt; // ...other routes. &lt;/Route&gt; &lt;/Route&gt; &lt;/Router&gt;, document.querySelector(&#39;.app&#39;)); components/App.js Our App component should now have access to the Redux store via context. Although, it is usually better practice to react-redux&#39;s connect to only expose a subset of the store. Let&#39;s see what the App component might look like: import {bindActionCreators} from &#39;redux&#39;; import React from &#39;react&#39;; import {connect} from &#39;react-redux&#39;; import {someApiFetch} from &#39;../actions/someApi&#39;; @connect( state =&gt; ({user: state.user}), dispatch =&gt; bindActionCreators({someApiFetch}, dispatch) ) export default class App extends React.Component { constructor(props, context) { super(props, context); if (this.props.user.loggedIn) { this.props.someApiFetch(); } } render() { return &lt;div&gt; &lt;p&gt;Logged in as {this.props.user.name}!&lt;/p&gt; &lt;/div&gt; } } But that&#39;s out of the scope of this post. You can read more about implementing higher-level Redux components at react-redux. Hope this routes you in the right direction!"/>

  </head>

  <body>
    <div id="wrap" class="c">
      <header>
        <div class="logos">
          <h1 id="logo">
            <a href='/'>ngo<strong>kevin</strong></a>
            <span class="social">
              <a href="mailto:me@ngokevin.com"><i class="fa fa-envelope"></i></a>
              <a href="http://twitter.com/andgokevin"><i class="fa fa-twitter-square"></i></a>
              <a href="http://github.com/ngokevin"><i class="fa fa-github-square"></i></a>
              <a type="application/rss+xml" href="/rss"><i class="fa fa-rss-square"></i></a>
            </span>
          </h1>
          <span id="sublogo">virtual reality developer at mozilla</span>
          <ul class="blog-tags">
            
              <li>
                <a href="/blog/tags/code/"
                   >
                  Code</a>
              </li>
            
              <li>
                <a href="/blog/tags/life/"
                   >
                  Life</a>
              </li>
            
              <li>
                <a href="/blog/tags/photography/"
                   >
                  Shoot</a>
              </li>
            
              <li>
                <a href="/blog/tags/poker/"
                   >
                  Poker</a>
              </li>
            
          </ul>
        </div>

        <nav>
          
            <a href="/about/">
              <span>
                About</span>
            </a>
          
            <a href="/">
              <span>
                Write</span>
            </a>
          
            <a href="/photography/">
              <span>
                Shoot</span>
            </a>
          
        </nav>
      </header>

      <div class="main">
        <div class="header-group">
  <div class="blog">
    <h1>Using react-router with redux</h1>

    <p class="metadata">
      
        Tuesday August 18, 2015
      
    </p>
  </div>

  <div id="top-share" class="addthis_toolbox addthis_default_style">
  <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
  <a class="addthis_button_tweet"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-513af3cd5e69b4ae"></script>
</div>

        <div class="base-image">
          
            <div class="page_pic ">
              <img class="captioned" src="http://i.imgur.com/6Jqxo6Kl.jpg">
              <div class="page-caption"><span>Filler image! Atop Whistler Mountain near Vancouver, BC.</span></div>
            </div>
          
        </div>

        
  <div class="page c">
    <p>I'm working on submission and reviewer tools for FirefoxOS add-ons, which I'd
like to shout out is the most exciting thing to hit FirefoxOS yet. It'll enable
a customization community as powerful as CyanogenMod yet be much more
accessible.</p>
<p>For this project, I wanted to port our Flux framework from
<a href="http://acdlite.github.io/flummox">Flummox</a> to
<a href="http://rackt.github.io/redux/docs/introduction/index.html">Redux</a> while using
<a href="https://github.com/rackt/react-router/">react-router</a>. I always struggle with
getting react-router to pass Redux-related context to the handler components.
Having done this twice and running into many pitfalls, I am sharing my
experiences to prospective struggle-bus riders.</p>
<p>Note this guide will feature:</p>
<ul>
<li>ES6 code</li>
<li>react@0.13</li>
<li>react-redux@0.9.0</li>
<li>react-router@1.0.0-beta1</li>
<li>redux@1.0.0</li>
</ul>
<p>If you are behind on these versions, I recommend upgrading. The Flux community
is moving very rapidly, so keep up.</p>
<h3 id="appjs">app.js</h3>
<p>Have your Redux store created. This is explained in the Redux documentation so
I won't go into detail here. But I will note that we are using
<a href="https://github.com/acdlite">acdlite's</a> <code>redux-react-router</code> library which
conveniently makes availalbe react-router state inside of our Redux store, and
features action creators for react-router.</p>
<div class="highlight"><pre><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Provider</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react-redux&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Route</span><span class="p">,</span> <span class="nx">Router</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react-router&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">history</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react-router/lib/BrowserHistory&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">combineReducers</span><span class="p">,</span> <span class="nx">createStore</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;redux&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">reduxRouteComponent</span><span class="p">,</span>
        <span class="nx">routerStateReducer</span> <span class="nx">as</span> <span class="nx">router</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;redux-react-router&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="nx">App</span> <span class="nx">from</span> <span class="s1">&#39;./components/App&#39;</span><span class="p">;</span>


<span class="kr">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="nx">combineReducers</span><span class="p">({</span>
  <span class="nx">router</span><span class="o">:</span> <span class="nx">routerStateReducer</span><span class="p">,</span>
  <span class="c1">// ...other reducers.</span>
<span class="p">});</span>
<span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">(</span><span class="nx">reducer</span><span class="p">);</span>
</pre></div>


<p>Next, imagine that <code>App</code> is our root-level handler component. We're going
to need to wrap it with a Redux Provider such that it has access to the Redux
store.</p>
<p>Why do we need to do this? We are using <code>redux-react-router</code> which should
magically handle passing the Redux store as context into the handler component
for us, but unfortunately <code>react@0.13</code> does owner-based context which kills
this feature. <code>react@0.14</code> will do parent-based context so this will work
in the future without need for wrapping. Owner-based context is also why we
wrap our component in a function inside the Provider.</p>
<div class="highlight"><pre><span class="kr">class</span> <span class="nx">ReduxApp</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Provider</span> <span class="nx">store</span><span class="o">=</span><span class="p">{</span><span class="nx">store</span><span class="p">}</span><span class="o">&gt;</span>
      <span class="p">{()</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">App</span> <span class="p">{...</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">}</span><span class="o">/&gt;</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="err">/Provider&gt;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Now let's build our Router and start the render:</p>
<div class="highlight"><pre><span class="nx">React</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">Router</span> <span class="nx">history</span><span class="o">=</span><span class="p">{</span><span class="nx">history</span><span class="p">}</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">reduxRouteComponent</span><span class="p">(</span><span class="nx">store</span><span class="p">)}</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;app&quot;</span> <span class="nx">path</span><span class="o">=</span><span class="s2">&quot;/&quot;</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">ReduxApp</span><span class="p">}</span><span class="o">&gt;</span>
      <span class="c1">// ...other routes.</span>
    <span class="o">&lt;</span><span class="err">/Route&gt;</span>
  <span class="o">&lt;</span><span class="err">/Route&gt;</span>
<span class="o">&lt;</span><span class="err">/Router&gt;, document.querySelector(&#39;.app&#39;));</span>
</pre></div>


<h3 id="componentsappjs">components/App.js</h3>
<p>Our <code>App</code> component should now have access to the Redux store via context.
Although, it is usually better practice to react-redux's <code>connect</code> to
only expose a subset of the store. Let's see what the <code>App</code> component
might look like:</p>
<div class="highlight"><pre><span class="kr">import</span> <span class="p">{</span><span class="nx">bindActionCreators</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;redux&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">connect</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react-redux&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="p">{</span><span class="nx">someApiFetch</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../actions/someApi&#39;</span><span class="p">;</span>


<span class="err">@</span><span class="nx">connect</span><span class="p">(</span>
  <span class="nx">state</span> <span class="o">=&gt;</span> <span class="p">({</span><span class="nx">user</span><span class="o">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">user</span><span class="p">}),</span>
  <span class="nx">dispatch</span> <span class="o">=&gt;</span> <span class="nx">bindActionCreators</span><span class="p">({</span><span class="nx">someApiFetch</span><span class="p">},</span> <span class="nx">dispatch</span><span class="p">)</span>
<span class="p">)</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">App</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">loggedIn</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">someApiFetch</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Logged</span> <span class="k">in</span> <span class="nx">as</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">!&lt;</span><span class="err">/p&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>But that's out of the scope of this post. You can read more about implementing
higher-level Redux components at
<a href="https://github.com/rackt/react-redux">react-redux</a>. Hope this routes you
in the right direction!</p>
  </div>

  <p class="end-sect">&sect;</p>
  <div id="bottom-share" class="addthis_toolbox addthis_default_style">
  <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
  <a class="addthis_button_tweet"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-513af3cd5e69b4ae"></script>
   <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'ngokevin'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
           var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
           dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
           (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
  <script src="https://cdn.jsdelivr.net/anchorjs/3.0.0/anchor.min.js"></script>
  <script>anchors.add('h2, h3, h4, h5, h6');</script>

      </div>
    </div>

    <div id="footer">
      <a href="mailto:me@ngokevin.com"><i class="fa fa-envelope"></i></a>
      <a href="http://twitter.com/ngokevin_"><i class="fa fa-twitter-square"></i></a>
      <a href="http://github.com/ngokevin"><i class="fa fa-github-square"></i></a>
      <a type="application/rss+xml" href="/rss/index.xml"><i class="fa fa-rss-square"></i></a>
    </div>

     <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-29871909-1']);
  _gaq.push(['_trackPageview']);

  (function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
  </body>
</html>