<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhml"
      xmlns:fb="http://ogp.me/ns/fb#"
      xml:lang="en" lang="en">

  <head>
    <title>ngokevin | Mock Unit Testing a AngularJS Local Storage Service with Karma and Jasmine</title>
    <link rel="stylesheet" type="text/css" href="/css/bundle.css" />
    <link href='http://fonts.googleapis.com/css?family=Ubuntu:400,500,700' rel='stylesheet' type='text/css'>
    <link rel="icon" type="image/x-icon" href="/img/favicon.ico?v=5"/>
    <meta name="viewport" content="width=device-width">
    
  <link rel="stylesheet" type="text/css" href="/css/page.css" />
  
    <meta property="og:image" content="http://i.imgur.com/60Xnrfn.png"/>
  
  <meta property="og:description" content="For a five-part introduction to AngularJS, check out my ng-okevin&#39;s Angular. I recently migrated my AngularJS to-do list app to AngularJS, and I wanted to unit test my Angular service that had a Local Storage schema migration. My app had a service that abstracted all interactions with Local Storage and implemented an interface to my list &#34;model&#34;. In this service, I modified the Local Storage schema, making it backwards-incompatible, so I wrote a migration. To make sure it worked, I unit-tested the entire service. To unit-test Angular, I used: Karma - a JS test runner Jasmine - a JS testing framework (setups, teardowns, assertions), automatically installed with Karma Angular Mocks - to mock out our application Directory Structure If you want to see for yourself my directory structure, check out the source code of my unit tests. I keep a folder within my app called tests that makes room for both unit tests and end-to-end tests. . |-- tests | |-- e2e_tests | | |-- conf.js | | |-- minimalist_spec.js | | `-- selenium | | |-- chromedriver | | |-- selenium-server-standalone-2.37.0.jar | | `-- start | |-- node_modules | | |-- karma | |-- package.json | |-- services.tests.js | `-- unit_tests | |-- karma.config.js | |-- lib | | `-- angular-mocks.js | `-- services.tests.js `-- Setting Up the Karma Test Runner Install Karma. npm install karma Go into your unit test directory and initialize a configuration file. This will lead you through an interactive shell. karma init karma.config.js Look at your configuration file and make sure everything is correct. Things to double-check are basePath, files, frameworks, and browser. Here is my Karma config basePath - this will affect the paths in the files option. I recommend setting it to root of your app to be able to include the required angular.js which probably lies outside the test folder. I had it set to ../../. files - this loads files into the browser when testing. Make sure all necessary files are included. This option takes patterns with wildcards as well, something like {pattern: &#39;tests/unit_tests/*.js&#39;, included: true}. Don&#39;t forget to include Angular Mocks. frameworks - set this to jasmine. Don&#39;t know other frameworks, don&#39;t care. browser - since we&#39;re unit testing, generally set this to PhantomJS so it doesn&#39;t pop up a browser every run. Then we can start the Karma runner to run our tests. karma start karma.config.js Writing Jasmine Unit Tests Jasmine unit tests, to me, are just like any other unit testing framework, but more designed to be read like English. In essence it is the same, there are test suites, test cases, setups, teardowns, and mocking. Here is my entire unit test for reference. The Jasmine docs should be your primary source for learning what the tests look like, but here is an excerpt from my own. describe(&#39;ItemService&#39;, function() { var store = {}; var ls = function() { return JSON.parse(store.storage); }; beforeEach(function() { // setUp. module(&#39;MinimalistApp&#39;); // LocalStorage mock. spyOn(localStorage, &#39;getItem&#39;).andCallFake(function(key) { return store[key]; }); Object.defineProperty(sessionStorage, &#34;setItem&#34;, { writable: true }); spyOn(localStorage, &#39;setItem&#39;).andCallFake(function(key, value) { store[key] = value; }); }); afterEach(function () { store = {}; }); it(&#39;migrate from legacy to version 0.&#39;, function() { store = { lastViewedList: 0, lists: [&#39;sample&#39;, &#39;sample_two&#39;], sample: { id: 0, list: [ { id: 1, items: [&#39;item1&#39;, &#39;item2&#39;], rank: 2 }, { id: 2, items: [&#39;item3&#39;, &#39;item4&#39;], rank: 1 } ] }, sample_two: { id: 1, list: [ { id: 1, items: [&#39;item5&#39;], rank: 1, } ] }, }; localStorage.setItem(&#39;storage&#39;, JSON.stringify(store)); inject(function(ItemService) { var sample = ItemService.getList(0); expect(sample.itemIndex.length, 2); expect(sample.items[0].text).toEqual(&#39;item3\nitem4&#39;); expect(sample.items[1].text).toEqual(&#39;item1\nitem2&#39;); sample = ItemService.getLists()[1]; expect(sample.itemIndex.length, 1); expect(sample.items[0].text).toEqual(&#39;item5&#39;); }); }); }); Initializing a Jasmine Test Suite I&#39;ll describe portions of the code starting from the top. describe(&#39;ItemService&#39;, function() { // ... }); Setup and Mocking LocalStorage This initializes our test suite for our module. var store = {}; beforeEach(function() { // setUp. module(&#39;MinimalistApp&#39;); // LocalStorage mock. spyOn(localStorage, &#39;getItem&#39;).andCallFake(function(key) { return store[key]; }); Object.defineProperty(sessionStorage, &#34;setItem&#34;, { writable: true }); spyOn(localStorage, &#39;setItem&#39;).andCallFake(function(key, value) { store[key] = value; }); }); The setup called before each test case for initialization. We mock out our app with Angular Mock&#39;s module to allow us to inject, or import, the modules or pieces of our code that we wish to test. Then we set up our Local Storage mock. we use Jasmine&#39;s spyOn to mock localStorage.getItem and localStorage.setItem. This watches for calls to these methods, and instead of calling the code it normally runs, it&#39;ll instead call the function that we pass into andCallFake. Here, the functions we pass into andCallFake simply interact with a plain Javascript object, store. We have mocked our Local Storage with a Javascript object, making infinitely easier to test. Everything is under our control. If you wish to mock Local Storage as well, definitely steal this code snippet. afterEach(function () { store = {}; }); Jasmine Test Cases The teardown called after each test case to reset the state. Here, we basically clear our Local Storage. it(&#39;migrate from legacy to version 0.&#39;, function() { // ... }); Injecting Angular Modules A single test case. The test case is created with it where we pass in a string describing the behavior we are testing and the test case itself. inject(function(ItemService) { var sample = ItemService.getList(0); expect(sample.itemIndex.length, 2); expect(sample.items[0].text).toEqual(&#39;item3\nitem4&#39;); expect(sample.items[1].text).toEqual(&#39;item1\nitem2&#39;); sample = ItemService.getLists()[1]; expect(sample.itemIndex.length, 1); expect(sample.items[0].text).toEqual(&#39;item5&#39;); }); After some test case setup code, we finally get to the juicy test assertions. We call Angular Mock&#39;s inject to import our service into the test case. I assume the Angular app module namespace is searched to pull out the module so make sure the parameter name matches what we want to import. Jasmine Assertions To run a basic assertion, we call Jasmine&#39;s expect, passing in the first value, and then toEqual to assert that its value is equivalent to what we expect. Jasmine is interesting how everything is modeled after being an English sentence. That&#39;s all. For additional resources, check out this guide and my app&#39;s source code. I will soon be writing about how to write end-to-end (E2E) tests for Angular apps with Protractor."/>

  </head>

  <body>
    <div id="wrap" class="c">
      <header>
        <div class="logos">
          <h1 id="logo">
            <a href='/'>ngo<strong>kevin</strong></a>
            <span class="social">
              <a href="mailto:me@ngokevin.com"><i class="fa fa-envelope"></i></a>
              <a href="http://twitter.com/andgokevin"><i class="fa fa-twitter-square"></i></a>
              <a href="http://github.com/ngokevin"><i class="fa fa-github-square"></i></a>
              <a type="application/rss+xml" href="/rss"><i class="fa fa-rss-square"></i></a>
            </span>
          </h1>
          <span id="sublogo">virtual reality developer at mozilla</span>
          <ul class="blog-tags">
            
              <li>
                <a href="/blog/tags/code/"
                   >
                  Code</a>
              </li>
            
              <li>
                <a href="/blog/tags/life/"
                   >
                  Life</a>
              </li>
            
              <li>
                <a href="/blog/tags/photography/"
                   >
                  Shoot</a>
              </li>
            
              <li>
                <a href="/blog/tags/poker/"
                   >
                  Poker</a>
              </li>
            
          </ul>
        </div>

        <nav>
          
            <a href="/about/">
              <span>
                About</span>
            </a>
          
            <a href="/">
              <span>
                Write</span>
            </a>
          
            <a href="/photography/">
              <span>
                Shoot</span>
            </a>
          
        </nav>
      </header>

      <div class="main">
        <div class="header-group">
  <div class="blog">
    <h1>Mock Unit Testing a AngularJS Local Storage Service with Karma and Jasmine</h1>

    <p class="metadata">
      
        Tuesday January 21, 2014
      
    </p>
  </div>

  <div id="top-share" class="addthis_toolbox addthis_default_style">
  <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
  <a class="addthis_button_tweet"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-513af3cd5e69b4ae"></script>
</div>

        <div class="base-image">
          
            <div class="page_pic ">
              <img src="http://i.imgur.com/60Xnrfn.png">
              
            </div>
          
        </div>

        
  <div class="page c">
    <p>For a five-part introduction to AngularJS, check out my <a href="/blog/angular-1">ng-okevin's
Angular</a>.</p>
<p>I recently migrated my <a href="http://marketplace.firefox.com/app/minimalist">AngularJS to-do list app</a>
to <a href="http://angularjs.org">AngularJS</a>, and I wanted
to unit test my Angular service that had a Local Storage schema migration.
My app had a
<a href="https://github.com/ngokevin/minimalist/blob/060a3bbc082f10d8305ef97871911b20f073e472/media/js/services.js">service</a>
that abstracted all interactions with Local Storage and implemented an
interface to my list "model". In this service, I modified the
Local Storage schema, making it backwards-incompatible, so I wrote a migration.
To make sure it worked, I unit-tested the entire service.</p>
<p>To unit-test Angular, I used:</p>
<ul>
<li><a href="http://karma-runner.github.io/0.10/index.html">Karma</a> - a JS test runner</li>
<li><a href="http://pivotal.github.io/jasmine/">Jasmine</a> - a JS testing framework
  (setups, teardowns, assertions), automatically installed with Karma</li>
<li><a href="https://raw2.github.com/angular/angular.js/master/src/ngMock/angular-mocks.js">Angular Mocks</a> - to mock out our application</li>
</ul>
<h2 id="directory-structure">Directory Structure</h2>
<p>If you want to see for yourself my directory structure, check out
<a href="https://github.com/ngokevin/minimalist/tree/060a3bbc082f10d8305ef97871911b20f073e472/tests/unit_tests">the source code of my unit tests.</a></p>
<p>I keep a folder within my app called <code>tests</code> that makes room for both unit
tests and end-to-end tests.</p>
<div class="highlight"><pre>.
|-- tests
|   |-- e2e_tests
|   |   |-- conf.js
|   |   |-- minimalist_spec.js
|   |   `-- selenium
|   |       |-- chromedriver
|   |       |-- selenium-server-standalone-2.37.0.jar
|   |       `-- start
|   |-- node_modules
|   |   |-- karma
|   |-- package.json
|   |-- services.tests.js
|   `-- unit_tests
|       |-- karma.config.js
|       |-- lib
|       |   `-- angular-mocks.js
|       `-- services.tests.js
`--
</pre></div>


<h2 id="setting-up-the-karma-test-runner">Setting Up the Karma Test Runner</h2>
<p>Install Karma.</p>
<div class="highlight"><pre>npm install karma
</pre></div>


<p>Go into your unit test directory and initialize a configuration file. This will
lead you through an interactive shell.</p>
<div class="highlight"><pre>karma init karma.config.js
</pre></div>


<p>Look at your configuration file and make sure everything is correct. Things to
double-check are <code>basePath</code>, <code>files</code>, <code>frameworks</code>, and
<code>browser</code>. Here is my
<a href="https://github.com/ngokevin/minimalist/blob/060a3bbc082f10d8305ef97871911b20f073e472/tests/unit_tests/karma.config.js">Karma config</a></p>
<ul>
<li><code>basePath</code> - this will affect the paths in the <code>files</code> option. I recommend
             setting it to root of your app to be able to include the required
             angular.js which probably lies outside the test folder. I had it
             set to <code>../../</code>.</li>
<li><code>files</code> - this loads files into the browser when testing. Make sure all necessary files
          are included. This option takes patterns with wildcards as well,
          something like <code>{pattern: 'tests/unit_tests/*.js', included: true}</code>.
          Don't forget to include Angular Mocks.</li>
<li><code>frameworks</code> - set this to <code>jasmine</code>. Don't know other frameworks, don't care.</li>
<li><code>browser</code> - since we're unit testing, generally set this to <code>PhantomJS</code> so
                 it doesn't pop up a browser every run.</li>
</ul>
<p>Then we can start the Karma runner to run our tests.</p>
<div class="highlight"><pre>karma start karma.config.js
</pre></div>


<h2 id="writing-jasmine-unit-tests">Writing Jasmine Unit Tests</h2>
<p>Jasmine unit tests, to me, are just like any other unit testing framework, but
more designed to be read like English. In essence it is the same, there are
test suites, test cases, setups, teardowns, and mocking. Here is
<a href="https://github.com/ngokevin/minimalist/blob/060a3bbc082f10d8305ef97871911b20f073e472/tests/unit_tests/services.tests.js">my entire unit test for reference.</a></p>
<p>The <a href="http://pivotal.github.io/jasmine/">Jasmine docs</a> should be your primary
source for learning what the tests look like, but here is an excerpt from my
own.</p>
<div class="highlight"><pre><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;ItemService&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">store</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="kd">var</span> <span class="nx">ls</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">store</span><span class="p">.</span><span class="nx">storage</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// setUp.</span>
        <span class="nx">module</span><span class="p">(</span><span class="s1">&#39;MinimalistApp&#39;</span><span class="p">);</span>

        <span class="c1">// LocalStorage mock.</span>
        <span class="nx">spyOn</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">,</span> <span class="s1">&#39;getItem&#39;</span><span class="p">).</span><span class="nx">andCallFake</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">store</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
        <span class="p">});</span>
        <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">sessionStorage</span><span class="p">,</span> <span class="s2">&quot;setItem&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">writable</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
        <span class="nx">spyOn</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">,</span> <span class="s1">&#39;setItem&#39;</span><span class="p">).</span><span class="nx">andCallFake</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">store</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">});</span>

    <span class="nx">afterEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">store</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">});</span>

    <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;migrate from legacy to version 0.&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">store</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">lastViewedList</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">lists</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_two&#39;</span><span class="p">],</span>
            <span class="nx">sample</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">id</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="nx">list</span><span class="o">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="nx">items</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;item1&#39;</span><span class="p">,</span> <span class="s1">&#39;item2&#39;</span><span class="p">],</span>
                        <span class="nx">rank</span><span class="o">:</span> <span class="mi">2</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nx">id</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="nx">items</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;item3&#39;</span><span class="p">,</span> <span class="s1">&#39;item4&#39;</span><span class="p">],</span>
                        <span class="nx">rank</span><span class="o">:</span> <span class="mi">1</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">},</span>
            <span class="nx">sample_two</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="nx">list</span><span class="o">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="nx">items</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;item5&#39;</span><span class="p">],</span>
                        <span class="nx">rank</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">},</span>

        <span class="p">};</span>
        <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;storage&#39;</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">store</span><span class="p">));</span>

        <span class="nx">inject</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ItemService</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">sample</span> <span class="o">=</span> <span class="nx">ItemService</span><span class="p">.</span><span class="nx">getList</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
            <span class="nx">expect</span><span class="p">(</span><span class="nx">sample</span><span class="p">.</span><span class="nx">itemIndex</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
            <span class="nx">expect</span><span class="p">(</span><span class="nx">sample</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">text</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="s1">&#39;item3\nitem4&#39;</span><span class="p">);</span>
            <span class="nx">expect</span><span class="p">(</span><span class="nx">sample</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">text</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="s1">&#39;item1\nitem2&#39;</span><span class="p">);</span>

            <span class="nx">sample</span> <span class="o">=</span> <span class="nx">ItemService</span><span class="p">.</span><span class="nx">getLists</span><span class="p">()[</span><span class="mi">1</span><span class="p">];</span>
            <span class="nx">expect</span><span class="p">(</span><span class="nx">sample</span><span class="p">.</span><span class="nx">itemIndex</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
            <span class="nx">expect</span><span class="p">(</span><span class="nx">sample</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">text</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="s1">&#39;item5&#39;</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>


<h3 id="initializing-a-jasmine-test-suite">Initializing a Jasmine Test Suite</h3>
<p>I'll describe portions of the code starting from the top.</p>
<div class="highlight"><pre><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;ItemService&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">});</span>
</pre></div>


<h3 id="setup-and-mocking-localstorage">Setup and Mocking LocalStorage</h3>
<p>This initializes our test suite for our module.</p>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">store</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// setUp.</span>
    <span class="nx">module</span><span class="p">(</span><span class="s1">&#39;MinimalistApp&#39;</span><span class="p">);</span>

    <span class="c1">// LocalStorage mock.</span>
    <span class="nx">spyOn</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">,</span> <span class="s1">&#39;getItem&#39;</span><span class="p">).</span><span class="nx">andCallFake</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">store</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
    <span class="p">});</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">sessionStorage</span><span class="p">,</span> <span class="s2">&quot;setItem&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">writable</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
    <span class="nx">spyOn</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">,</span> <span class="s1">&#39;setItem&#39;</span><span class="p">).</span><span class="nx">andCallFake</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">store</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>


<p>The setup called before each test case for initialization. We mock out our app
with Angular Mock's <code>module</code> to allow us to inject, or import, the modules or
pieces of our code that we wish to test.</p>
<p>Then we set up our Local Storage mock. we use Jasmine's <code>spyOn</code> to mock
<code>localStorage.getItem</code> and <code>localStorage.setItem</code>. This watches for
calls to these methods, and instead of calling the code it normally runs, it'll
instead call the function that we pass into <code>andCallFake</code>. Here, the
functions we pass into <code>andCallFake</code> simply interact with a plain
Javascript object, <code>store</code>. We have mocked our Local Storage with a
Javascript object, making infinitely easier to test. Everything is under our
control. If you wish to mock Local Storage as well, definitely steal this code
snippet.</p>
<div class="highlight"><pre><span class="nx">afterEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">store</span> <span class="o">=</span> <span class="p">{};</span>
<span class="p">});</span>
</pre></div>


<h3 id="jasmine-test-cases">Jasmine Test Cases</h3>
<p>The teardown called after each test case to reset the state. Here, we basically
clear our Local Storage.</p>
<div class="highlight"><pre><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;migrate from legacy to version 0.&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">});</span>
</pre></div>


<h3 id="injecting-angular-modules">Injecting Angular Modules</h3>
<p>A single test case. The test case is created with <code>it</code> where we pass in  a
string describing the behavior we are testing and the test case itself.</p>
<div class="highlight"><pre>inject(function(ItemService) {
    var sample = ItemService.getList(0);
    expect(sample.itemIndex.length, 2);
    expect(sample.items[0].text).toEqual(&#39;item3\nitem4&#39;);
    expect(sample.items[1].text).toEqual(&#39;item1\nitem2&#39;);

    sample = ItemService.getLists()[1];
    expect(sample.itemIndex.length, 1);
    expect(sample.items[0].text).toEqual(&#39;item5&#39;);
});
</pre></div>


<p>After some test case setup code, we finally get to the juicy test assertions.
We call Angular Mock's <code>inject</code> to import our service into the test case. I
assume the Angular app module namespace is searched to pull out the module so
make sure the parameter name matches what we want to import.</p>
<h3 id="jasmine-assertions">Jasmine Assertions</h3>
<p>To run a basic assertion, we call Jasmine's <code>expect</code>, passing in the first
value, and then <code>toEqual</code> to assert that its value is equivalent to what we
expect. Jasmine is interesting how everything is modeled after being an English
sentence.</p>
<p>That's all. For additional resources, check out <a href="http://www.tuesdaydeveloper.com/2013/06/angularjs-testing-with-karma-
and-jasmine/">this
guide</a> and <a href="http://github.com/ngokevin/minimalist">my app's source
code</a>. I will soon be writing about
how to write end-to-end (E2E) tests for Angular apps with Protractor.</p>
  </div>

  <p class="end-sect">&sect;</p>
  <div id="bottom-share" class="addthis_toolbox addthis_default_style">
  <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
  <a class="addthis_button_tweet"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-513af3cd5e69b4ae"></script>
   <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'ngokevin'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
           var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
           dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
           (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
  <script src="https://cdn.jsdelivr.net/anchorjs/3.0.0/anchor.min.js"></script>
  <script>anchors.add('h2, h3, h4, h5, h6');</script>

      </div>
    </div>

    <div id="footer">
      <a href="mailto:me@ngokevin.com"><i class="fa fa-envelope"></i></a>
      <a href="http://twitter.com/ngokevin_"><i class="fa fa-twitter-square"></i></a>
      <a href="http://github.com/ngokevin"><i class="fa fa-github-square"></i></a>
      <a type="application/rss+xml" href="/rss/index.xml"><i class="fa fa-rss-square"></i></a>
    </div>

     <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-29871909-1']);
  _gaq.push(['_trackPageview']);

  (function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
  </body>
</html>